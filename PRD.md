# è£½å“è¦æ±‚ä»•æ§˜æ›¸ (PRD): SmartKnowledgeBot

## 1. æ¦‚è¦

### 1.1. ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆå
**SmartKnowledgeBot** (ã‚¹ãƒãƒ¼ãƒˆãƒŠãƒ¬ãƒƒã‚¸ãƒœãƒƒãƒˆ)

### 1.2. ãƒªãƒã‚¸ãƒˆãƒªå
- ãƒ¡ã‚¤ãƒ³ãƒªãƒã‚¸ãƒˆãƒª: `smart-knowledge-bot`
- AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ: `skb-intelligence` (ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª)
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹: `skb-datastore` (ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª)

### 1.3. ç›®çš„
ä»»æ„ã®Webã‚µã‚¤ãƒˆã‚’çŸ¥è­˜ãƒ™ãƒ¼ã‚¹ã¨ã—ã€ãã®å†…å®¹ã«é–¢ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®è‡ªç„¶è¨€èªã§ã®è³ªå•ã«å¯¾ã—ã¦ã€çš„ç¢ºãªå›ç­”ã‚’ç”Ÿæˆãƒ»æä¾›ã™ã‚‹ã€æ±ç”¨çš„ãªQ&Aå¯¾å¿œAIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ ã€‚

### 1.4. ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼
- ä¼æ¥­ã®æŠ€è¡“ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç®¡ç†è€…
- ã‚²ãƒ¼ãƒ æ”»ç•¥ã‚µã‚¤ãƒˆé‹å–¶è€…
- è£½å“ã‚µãƒãƒ¼ãƒˆæ‹…å½“è€…
- ç ”ç©¶æ©Ÿé–¢ã®çŸ¥è­˜ç®¡ç†æ‹…å½“è€…

### 1.5. æœ€çµ‚å½¢æ…‹ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤æˆ¦ç•¥
1. **é–‹ç™ºãƒ•ã‚§ãƒ¼ã‚º**: Mastraãƒ—ãƒ¬ã‚¤ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã®æ©Ÿèƒ½æ¤œè¨¼
2. **æœ¬ç•ªãƒ•ã‚§ãƒ¼ã‚º**: 
   - Vercel/Netlifyã§ã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ‡ãƒ—ãƒ­ã‚¤
   - Next.js + Mastraçµ±åˆã«ã‚ˆã‚‹Webã‚¢ãƒ—ãƒªåŒ–
   - REST APIæä¾›ã«ã‚ˆã‚‹ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£çµ±åˆå¯¾å¿œ

## 2. ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

æœ¬ã‚·ã‚¹ãƒ†ãƒ ã¯å˜ä¸€ãƒªãƒã‚¸ãƒˆãƒªå†…ã®2ã¤ã®ã‚µãƒ–ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§æ§‹æˆã•ã‚Œã‚‹ï¼š

### 2.1. skb-intelligenceï¼ˆAIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå±¤ï¼‰
- **å½¹å‰²**: ãƒ¦ãƒ¼ã‚¶ãƒ¼å¯¾è©±ã€RAGãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã€Webæƒ…å ±åé›†
- **æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯**: 
  - Mastra v0.10.5ï¼ˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼‰
  - Google Generative AIï¼ˆGemini 1.5 Proã€embedding-001ï¼‰
  - LangChainï¼ˆãƒ†ã‚­ã‚¹ãƒˆåˆ†å‰²ãƒ»å‡¦ç†ï¼‰
  - Playwrightï¼ˆå …ç‰¢ãªWebã‚¯ãƒ­ãƒ¼ãƒ©ãƒ¼ï¼‰
  - TypeScript/Node.js

### 2.2. skb-datastoreï¼ˆãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–å±¤ï¼‰
- **å½¹å‰²**: çŸ¥è­˜ãƒ™ãƒ¼ã‚¹ç®¡ç†ã€ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ã€ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ä¿è¨¼
- **æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯**:
  - Convex v1.24.8ï¼ˆã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼‰
  - ãƒ™ã‚¯ãƒˆãƒ«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆ768æ¬¡å…ƒï¼‰
  - HTTPãƒ™ãƒ¼ã‚¹API

## 3. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### 3.1. crawled_pages ãƒ†ãƒ¼ãƒ–ãƒ«
```typescript
{
  url: string,        // ã‚¯ãƒ­ãƒ¼ãƒ«å¯¾è±¡URL
  text: string,       // æŠ½å‡ºã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆ
  status: string      // "pending" | "processed" | "error"
}
```

### 3.2. documents ãƒ†ãƒ¼ãƒ–ãƒ«
```typescript
{
  text: string,              // ãƒãƒ£ãƒ³ã‚¯åŒ–ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆ
  embedding: number[]        // 768æ¬¡å…ƒãƒ™ã‚¯ãƒˆãƒ«ï¼ˆGoogleGenerativeAI embedding-001ï¼‰
}
```
- ãƒ™ã‚¯ãƒˆãƒ«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹: `by_embedding`ï¼ˆ768æ¬¡å…ƒã€é¡ä¼¼åº¦æ¤œç´¢ç”¨ï¼‰

## 4. ä¸»è¦æ©Ÿèƒ½ã¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### 4.1. ãƒ‡ãƒ¼ã‚¿æº–å‚™ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆçŸ¥è­˜ãƒ™ãƒ¼ã‚¹æ§‹ç¯‰ï¼‰

#### Step 1: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–ï¼ˆä»»æ„ï¼‰
- **ãƒ„ãƒ¼ãƒ«**: `purge_knowledge_base`
- **å‡¦ç†**: æ—¢å­˜ã®çŸ¥è­˜ãƒ™ãƒ¼ã‚¹ï¼ˆ`crawled_pages`ãŠã‚ˆã³`documents`ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰ã‚’å®Œå…¨æ¶ˆå»
- **å®Ÿè£…**: `maintenance:purgeAll` Convex mutation

#### Step 2: Webã‚¯ãƒ­ãƒ¼ãƒ«
- **ãƒ„ãƒ¼ãƒ«**: `web_crawler`
- **å…¥åŠ›ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**:
  - `startUrl`: ã‚¯ãƒ­ãƒ¼ãƒ«é–‹å§‹URL
  - `maxDepth`: å·¡å›éšå±¤ï¼ˆ0-5ï¼‰
- **å‡¦ç†ãƒ•ãƒ­ãƒ¼**:
  1. è»½é‡fetch + Cheerio ã«ã‚ˆã‚‹é™çš„HTMLè§£æ
  2. åŒä¸€ãƒ‰ãƒ¡ã‚¤ãƒ³å†…ã®ãƒªãƒ³ã‚¯æŠ½å‡ºãƒ»è¿½è·¡
  3. ãƒãƒƒãƒå‡¦ç†ï¼ˆ10ä¸¦åˆ—ï¼‰ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå¯¾ç­–
  4. å„ãƒšãƒ¼ã‚¸ã‚’`crawled_pages`ãƒ†ãƒ¼ãƒ–ãƒ«ã«`status: "pending"`ã§ä¿å­˜
- **æŠ€è¡“çš„ç‰¹å¾´**:
  - Puppeteerã‹ã‚‰è»½é‡fetchã«å¤‰æ›´æ¸ˆã¿ï¼ˆå®‰å®šæ€§å‘ä¸Šï¼‰
  - 10ç§’ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š
  - User-Agentãƒ˜ãƒƒãƒ€ãƒ¼è¨­å®š

#### Step 3: ãƒ†ã‚­ã‚¹ãƒˆå‡¦ç†ã¨ãƒ™ã‚¯ãƒˆãƒ«åŒ–
- **ãƒ„ãƒ¼ãƒ«**: `process_pending_documents`
- **å‡¦ç†ãƒ•ãƒ­ãƒ¼**:
  1. `status: "pending"`ã®ãƒšãƒ¼ã‚¸ã‚’å–å¾—
  2. `RecursiveCharacterTextSplitter`ã§ãƒãƒ£ãƒ³ã‚¯åŒ–
     - `chunkSize: 1000`
     - `chunkOverlap: 200`
  3. `GoogleGenerativeAIEmbeddings`ï¼ˆmodels/embedding-001ï¼‰ã§ãƒ™ã‚¯ãƒˆãƒ«åŒ–
  4. `documents`ãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¿å­˜
  5. å…ƒãƒšãƒ¼ã‚¸ã®`status`ã‚’`"processed"`ã«æ›´æ–°

### 4.2. Q&Aãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å¯¾è©±ï¼‰

#### ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä»•æ§˜
- **åå‰**: Knowledge Base Assistant
- **ãƒ¢ãƒ‡ãƒ«**: Google Gemini 1.5 Pro Latest
- **è¨€èª**: æ—¥æœ¬èªã§ã®å¯¾è©±
- **æŒ‡ç¤º**: å¿…ãš`answer_question_from_docs`ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨

#### RAGãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
- **ãƒ„ãƒ¼ãƒ«**: `answer_question_from_docs`
- **å‡¦ç†ãƒ•ãƒ­ãƒ¼**:
  1. **è³ªå•ç¿»è¨³**: æ—¥æœ¬èªâ†’è‹±èªï¼ˆGemini 1.5 Proï¼‰
  2. **ãƒ™ã‚¯ãƒˆãƒ«åŒ–**: ç¿»è¨³ã•ã‚ŒãŸè³ªå•ã‚’embedding-001ã§ãƒ™ã‚¯ãƒˆãƒ«åŒ–
  3. **é¡ä¼¼åº¦æ¤œç´¢**: `search:byEmbedding`ã§ä¸Šä½5ä»¶å–å¾—
  4. **å›ç­”ç”Ÿæˆ**: è‹±èªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ + æ—¥æœ¬èªè³ªå•ã§æ—¥æœ¬èªå›ç­”ç”Ÿæˆ

## 5. æŠ€è¡“çš„æ±ºå®šäº‹é …ã¨è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³

### 5.1. è‡ªå·±å®Œçµå‹ãƒ„ãƒ¼ãƒ«ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- **èª²é¡Œ**: Mastraã®contextã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å‹å®šç¾©ä¸å®‰å®š
- **è§£æ±ºç­–**: å„ãƒ„ãƒ¼ãƒ«ãŒå¿…è¦ãªã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆConvexClientã€AI Clientï¼‰ã‚’å†…éƒ¨ã§åˆæœŸåŒ–
- **åˆ©ç‚¹**: ã‚·ã‚¹ãƒ†ãƒ å®‰å®šæ€§ã¨ä¿¡é ¼æ€§ã®å‘ä¸Š

### 5.2. ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³åˆ†é›¢æˆ¦ç•¥
- **èª²é¡Œ**: å˜ä¸€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§ã®é•·å¤§ã‚¿ã‚¹ã‚¯ç®¡ç†å›°é›£
- **è§£æ±ºç­–**: ã€Œã‚¯ãƒ­ãƒ¼ãƒ«ã€ã¨ã€Œå¾Œå‡¦ç†ã€ã®æ˜ç¢ºåˆ†é›¢
- **é‹ç”¨**: äººé–“ã«ã‚ˆã‚‹ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ãƒˆãƒªã‚¬ãƒ¼

### 5.3. å¤šè¨€èªå¯¾å¿œï¼ˆæ—¥è‹±ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ï¼‰
- **èª²é¡Œ**: è‹±èªçŸ¥è­˜ãƒ™ãƒ¼ã‚¹ vs æ—¥æœ¬èªè³ªå•ã®ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ãƒŸã‚¹ãƒãƒƒãƒ
- **è§£æ±ºç­–**: è³ªå•æ™‚ã®å‹•çš„ç¿»è¨³ï¼ˆæ—¥â†’è‹±ï¼‰
- **å®Ÿè£…**: Gemini 1.5 Proã«ã‚ˆã‚‹é«˜ç²¾åº¦ç¿»è¨³

### 5.4. ConvexClientå®Ÿè£…
- **è¨­è¨ˆ**: å„ãƒ„ãƒ¼ãƒ«ãŒç‹¬è‡ªã®HTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’æŒã¤
- **API**: `/api/query`ã€`/api/mutation`ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- **ç’°å¢ƒå¤‰æ•°**: `CONVEX_URL`ã€`GOOGLE_GENERATIVE_AI_API_KEY`

## 6. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

### 6.1. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
```
smart-knowledge-bot/
â”œâ”€â”€ README.md
â”œâ”€â”€ .gitignore
â”œâ”€â”€ .env.example
â”œâ”€â”€ docker-compose.yml             # é–‹ç™ºç’°å¢ƒçµ±åˆ
â”œâ”€â”€ skb-intelligence/              # AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå±¤
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ .env
â”‚   â”œâ”€â”€ src/mastra/
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ agents/
â”‚   â”‚   â”‚   â””â”€â”€ knowledge-agent.ts
â”‚   â”‚   â”œâ”€â”€ tools/
â”‚   â”‚   â”‚   â”œâ”€â”€ web-crawler.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ document-processor.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ knowledge-searcher.ts
â”‚   â”‚   â”‚   â””â”€â”€ system-maintenance.ts
â”‚   â”‚   â””â”€â”€ workflows/
â”‚   â”‚       â”œâ”€â”€ knowledge-ingestion.workflow.ts
â”‚   â”‚       â””â”€â”€ data-processing.workflow.ts
â”‚   â””â”€â”€ tests/
â”‚       â”œâ”€â”€ unit/
â”‚       â””â”€â”€ integration/
â”œâ”€â”€ skb-datastore/                 # ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–å±¤
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ .env
â”‚   â”œâ”€â”€ convex/
â”‚   â”‚   â”œâ”€â”€ schema.ts
â”‚   â”‚   â”œâ”€â”€ pages.ts
â”‚   â”‚   â”œâ”€â”€ knowledge.ts
â”‚   â”‚   â”œâ”€â”€ search.ts
â”‚   â”‚   â””â”€â”€ admin.ts
â”‚   â””â”€â”€ tests/
â”‚       â””â”€â”€ e2e/
â””â”€â”€ deployment/                    # ãƒ‡ãƒ—ãƒ­ã‚¤è¨­å®š
    â”œâ”€â”€ vercel.json
    â”œâ”€â”€ netlify.toml
    â””â”€â”€ docker/
```

### 6.2. å‘½åè¦å‰‡
- **ãƒ„ãƒ¼ãƒ«å**: å‹•è©+åè©å½¢å¼ï¼ˆä¾‹: `web-crawler`, `document-processor`ï¼‰
- **ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå**: å½¹å‰²+agentå½¢å¼ï¼ˆä¾‹: `knowledge-agent`ï¼‰
- **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å**: ç›®çš„+workflowå½¢å¼ï¼ˆä¾‹: `knowledge-ingestion.workflow`ï¼‰

## 7. ç’°å¢ƒè¨­å®šè¦ä»¶

### 7.1. å¿…é ˆç’°å¢ƒå¤‰æ•°
```bash
# agent/.env
CONVEX_URL=https://your-convex-deployment.convex.cloud
GOOGLE_GENERATIVE_AI_API_KEY=your-google-ai-api-key

# backend/.env
CONVEX_AUTH_TOKEN=your-convex-auth-token
```

### 7.2. å®Ÿè¡Œè¦ä»¶
- Node.js â‰¥ 20.9.0
- Convex CLI
- Google AI Studio APIã‚­ãƒ¼

## 8. é–‹ç™ºãƒ»å®Ÿè£…ã‚¿ã‚¹ã‚¯åˆ†å‰²

### 8.1. Phase 1: åŸºç›¤æ§‹ç¯‰ï¼ˆæ¨å®š3-4æ—¥ï¼‰

#### Task 1.1: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–ï¼ˆ30åˆ†ï¼‰
- [ ] GitHubãƒªãƒã‚¸ãƒˆãƒªä½œæˆï¼ˆ`smart-knowledge-bot`ï¼‰
- [ ] ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ä½œæˆ
- [ ] `.gitignore`, `README.md`, `.env.example`ä½œæˆ
- **æ¤œè¨¼**: ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ãŒæ­£ã—ãä½œæˆã•ã‚Œã¦ã„ã‚‹

#### Task 1.2: skb-datastoreåŸºç›¤æ§‹ç¯‰ï¼ˆ1-2æ™‚é–“ï¼‰
- [ ] Convexãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–
- [ ] `schema.ts`å®Ÿè£…ï¼ˆpages, knowledgeãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰
- [ ] åŸºæœ¬CRUDæ“ä½œå®Ÿè£…ï¼ˆpages.ts, knowledge.tsï¼‰
- **æ¤œè¨¼**: Convexãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆç¢ºèª

#### Task 1.3: skb-intelligenceåŸºç›¤æ§‹ç¯‰ï¼ˆ1-2æ™‚é–“ï¼‰
- [ ] Mastraãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåˆæœŸåŒ–
- [ ] åŸºæœ¬ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè£…ï¼ˆ`knowledge-agent.ts`ï¼‰
- [ ] ConvexClientå…±é€šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä½œæˆ
- **æ¤œè¨¼**: Mastraãƒ—ãƒ¬ã‚¤ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰èµ·å‹•ç¢ºèª

#### Task 1.4: ç’°å¢ƒå¤‰æ•°ãƒ»èªè¨¼è¨­å®šï¼ˆ30åˆ†ï¼‰
- [ ] ç’°å¢ƒå¤‰æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆ
- [ ] Google AI APIè¨­å®š
- [ ] Convexèªè¨¼è¨­å®š
- **æ¤œè¨¼**: ç’°å¢ƒå¤‰æ•°èª­ã¿è¾¼ã¿ãƒ»APIæ¥ç¶šãƒ†ã‚¹ãƒˆ

### 8.2. Phase 2: ã‚³ã‚¢ãƒ„ãƒ¼ãƒ«å®Ÿè£…ï¼ˆæ¨å®š4-5æ—¥ï¼‰

#### Task 2.1: system-maintenance.tsï¼ˆ1æ™‚é–“ï¼‰
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–æ©Ÿèƒ½
- [ ] ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯æ©Ÿèƒ½
- **æ¤œè¨¼**: ç©ºã®DBã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ã¾ã§æ­£å¸¸å‹•ä½œ

#### Task 2.2: web-crawler.tsï¼ˆ2-3æ™‚é–“ï¼‰
- [ ] PlaywrightåŸºç›¤å®Ÿè£…
- [ ] åŸºæœ¬ã‚¯ãƒ­ãƒ¼ãƒ«æ©Ÿèƒ½ï¼ˆå˜ä¸€ãƒšãƒ¼ã‚¸ï¼‰
- [ ] å†å¸°ã‚¯ãƒ­ãƒ¼ãƒ«æ©Ÿèƒ½
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ»ãƒªãƒˆãƒ©ã‚¤æ©Ÿæ§‹
- **æ¤œè¨¼**: æŒ‡å®šã‚µã‚¤ãƒˆã®ãƒšãƒ¼ã‚¸å–å¾—ãƒ»DBä¿å­˜ç¢ºèª

#### Task 2.3: document-processor.tsï¼ˆ2-3æ™‚é–“ï¼‰
- [ ] ãƒ†ã‚­ã‚¹ãƒˆåˆ†å‰²æ©Ÿèƒ½ï¼ˆLangChainï¼‰
- [ ] ãƒ™ã‚¯ãƒˆãƒ«åŒ–æ©Ÿèƒ½ï¼ˆGoogle Embeddingsï¼‰
- [ ] ãƒãƒƒãƒå‡¦ç†æ©Ÿèƒ½
- **æ¤œè¨¼**: ã‚¯ãƒ­ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ã®ãƒ™ã‚¯ãƒˆãƒ«åŒ–ãƒ»æ¤œç´¢ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½œæˆ

#### Task 2.4: knowledge-searcher.tsï¼ˆ2-3æ™‚é–“ï¼‰
- [ ] è³ªå•ç¿»è¨³æ©Ÿèƒ½ï¼ˆæ—¥â†’è‹±ï¼‰
- [ ] ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢æ©Ÿèƒ½
- [ ] å›ç­”ç”Ÿæˆæ©Ÿèƒ½ï¼ˆGeminiï¼‰
- [ ] å®Œå…¨ãªRAGãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³çµ±åˆ
- **æ¤œè¨¼**: è³ªå•å…¥åŠ›â†’å›ç­”å‡ºåŠ›ã®å…¨ãƒ•ãƒ­ãƒ¼å‹•ä½œç¢ºèª

### 8.3. Phase 3: çµ±åˆãƒ»æœ€é©åŒ–ï¼ˆæ¨å®š2-3æ—¥ï¼‰

#### Task 3.1: ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆçµ±åˆï¼ˆ1-2æ™‚é–“ï¼‰
- [ ] å…¨ãƒ„ãƒ¼ãƒ«ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç™»éŒ²
- [ ] ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ãƒ•ãƒ­ãƒ¼ç¢ºèª
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–
- **æ¤œè¨¼**: ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆçµŒç”±ã§ã®å…¨æ©Ÿèƒ½å‹•ä½œç¢ºèª

#### Task 3.2: ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å®Ÿè£…ï¼ˆ1-2æ™‚é–“ï¼‰
- [ ] `knowledge-ingestion.workflow.ts`
- [ ] `data-processing.workflow.ts`
- **æ¤œè¨¼**: ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼çµŒç”±ã§ã®ãƒãƒƒãƒå‡¦ç†å®Ÿè¡Œ

#### Task 3.3: ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆ2-3æ™‚é–“ï¼‰
- [ ] å˜ä½“ãƒ†ã‚¹ãƒˆï¼ˆå„ãƒ„ãƒ¼ãƒ«ï¼‰
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆRAGãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼‰
- [ ] E2Eãƒ†ã‚¹ãƒˆï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚·ãƒŠãƒªã‚ªï¼‰
- **æ¤œè¨¼**: å…¨ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹

### 8.4. Phase 4: æœ¬ç•ªåŒ–æº–å‚™ï¼ˆæ¨å®š2-3æ—¥ï¼‰

#### Task 4.1: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ï¼ˆ1æ—¥ï¼‰
- [ ] ãƒãƒƒãƒã‚µã‚¤ã‚ºèª¿æ•´
- [ ] ä¸¦åˆ—å‡¦ç†æœ€é©åŒ–
- [ ] ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡æœ€é©åŒ–
- **æ¤œè¨¼**: å¤§é‡ãƒ‡ãƒ¼ã‚¿ã§ã®å®‰å®šå‹•ä½œç¢ºèª

#### Task 4.2: ãƒ‡ãƒ—ãƒ­ã‚¤æº–å‚™ï¼ˆ1-2æ—¥ï¼‰
- [ ] Next.jsçµ±åˆæº–å‚™
- [ ] Vercel/Netlifyè¨­å®š
- [ ] æœ¬ç•ªç’°å¢ƒå¤‰æ•°è¨­å®š
- **æ¤œè¨¼**: ãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒã§ã®å‹•ä½œç¢ºèª

### 8.5. å„ã‚¿ã‚¹ã‚¯ã®å‹•ä½œç¢ºèªåŸºæº–

#### å¿…é ˆãƒã‚§ãƒƒã‚¯é …ç›®
1. **æ©Ÿèƒ½å‹•ä½œ**: æœŸå¾…ã•ã‚Œã‚‹å…¥å‡ºåŠ›ãŒæ­£ã—ãå‹•ä½œ
2. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: ç•°å¸¸ç³»ã§ã‚‚é©åˆ‡ã«ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡ºåŠ›
3. **ãƒ­ã‚°å‡ºåŠ›**: ãƒ‡ãƒãƒƒã‚°å¯èƒ½ãªãƒ¬ãƒ™ãƒ«ã§ãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã‚‹
4. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: æƒ³å®šãƒ‡ãƒ¼ã‚¿é‡ã§å®Ÿç”¨çš„ãªé€Ÿåº¦ã§å‹•ä½œ

#### Phaseå®Œäº†åŸºæº–
- **Phase 1**: åŸºæœ¬çš„ãªæ¥ç¶šãƒ»èªè¨¼ãŒå…¨ã¦å‹•ä½œ
- **Phase 2**: å„ãƒ„ãƒ¼ãƒ«ãŒç‹¬ç«‹ã—ã¦æœŸå¾…å‹•ä½œã‚’å®Ÿè¡Œ
- **Phase 3**: ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆçµŒç”±ã§å…¨æ©Ÿèƒ½ãŒçµ±åˆå‹•ä½œ
- **Phase 4**: æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤å¯èƒ½ãªå“è³ªãƒ»æ€§èƒ½

## 9. æ‹¡å¼µãƒã‚¤ãƒ³ãƒˆ

### 9.1. ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£
- ãƒãƒƒãƒã‚µã‚¤ã‚ºèª¿æ•´ã«ã‚ˆã‚‹ä¸¦åˆ—å‡¦ç†æœ€é©åŒ–
- ãƒãƒ£ãƒ³ã‚¯ã‚µã‚¤ã‚ºãƒ»ã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ—ã®ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ¥ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°
- è¤‡æ•°è¨€èªå¯¾å¿œã®æ‹¡å¼µ

### 9.2. æ©Ÿèƒ½è¿½åŠ å€™è£œ
- PDF/Wordæ–‡æ›¸å¯¾å¿œ
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ç›£è¦–
- ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥çŸ¥è­˜ãƒ™ãƒ¼ã‚¹åˆ†é›¢
- æ¤œç´¢çµæœã®é–¢é€£åº¦ã‚¹ã‚³ã‚¢è¡¨ç¤º

## 10. æŠ€è¡“ä»•æ§˜ãƒ»åˆ¶ç´„äº‹é …

### 10.1. å‰å›å®Ÿè£…ã®æ•™è¨“ã‚’æ´»ã‹ã—ãŸè¨­è¨ˆæ”¹å–„

#### ğŸ¯ **ç¢ºå®ŸãªæˆåŠŸè¦å› **
1. **çµ±ä¸€ã•ã‚ŒãŸãƒ„ãƒ¼ãƒ«ãƒ‘ã‚¿ãƒ¼ãƒ³**: å…¨ã¦`@mastra/core/tools`ã‚¤ãƒ³ãƒãƒ¼ãƒˆä½¿ç”¨
2. **ä¸€è²«ã—ãŸå¼•æ•°å‡¦ç†**: `execute: async ({ context }) => { const { param } = context; }`
3. **æ®µéšçš„æ¤œè¨¼**: å„Phaseã§å‹•ä½œç¢ºèªã‚’å¿…é ˆã¨ã™ã‚‹
4. **Playwrightæ¡ç”¨**: ã‚ˆã‚Šå …ç‰¢ãªã‚¯ãƒ­ãƒ¼ãƒ©ãƒ¼ï¼ˆå¾“æ¥ã®fetch+cheerioã‹ã‚‰å¤‰æ›´ï¼‰

#### ğŸš« **å›é¿ã™ã¹ãå•é¡Œãƒ‘ã‚¿ãƒ¼ãƒ³**
1. **æ··åœ¨ã—ãŸã‚¤ãƒ³ãƒãƒ¼ãƒˆ**: `@mastra/core` vs `@mastra/core/tools`
2. **ç›´æ¥ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å—ã‘å–ã‚Š**: `({ param })` ãƒ‘ã‚¿ãƒ¼ãƒ³ç¦æ­¢
3. **ä¸€æ‹¬å®Ÿè£…**: æ®µéšçš„ãƒ†ã‚¹ãƒˆãªã—ã§ã®å¤§é‡å®Ÿè£…
4. **ä¸å®‰å®šãªã‚¯ãƒ­ãƒ¼ãƒ©ãƒ¼**: fetchãƒ™ãƒ¼ã‚¹ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå•é¡Œ

### 10.2. æŠ€è¡“çš„åˆ¶ç´„ãƒ»ä»•æ§˜
- **ãƒ™ã‚¯ãƒˆãƒ«æ¬¡å…ƒ**: 768æ¬¡å…ƒå›ºå®šï¼ˆGoogle embedding-001ï¼‰
- **ã‚¯ãƒ­ãƒ¼ãƒ«å¯¾è±¡**: Playwrightå¯¾å¿œã‚µã‚¤ãƒˆï¼ˆJavaScriptå‹•çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å¯¾å¿œï¼‰
- **è¨€èªå¯¾å¿œ**: æ—¥æœ¬èªè³ªå•â†’è‹±èªæ¤œç´¢â†’æ—¥æœ¬èªå›ç­”
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**: Convexï¼ˆã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã€è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒ«ï¼‰
- **åŒæ™‚å‡¦ç†**: ãƒãƒƒãƒã‚µã‚¤ã‚º10ã§ã®ä¸¦åˆ—å‡¦ç†

### 10.3. é‹ç”¨åˆ¶ç´„
- **é–‹ç™ºç’°å¢ƒ**: Mastraãƒ—ãƒ¬ã‚¤ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰
- **æœ¬ç•ªç’°å¢ƒ**: Vercel/Netlify + REST API
- **APIåˆ¶é™**: Google AI APIãƒ¬ãƒ¼ãƒˆåˆ¶é™å¯¾å¿œ
- **ãƒ‡ãƒ¼ã‚¿å®¹é‡**: Convex Free tierã®åˆ¶é™å†…

## 11. å“è³ªä¿è¨¼ãƒ»ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### 11.1. å¿…é ˆãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³

#### å˜ä½“ãƒ†ã‚¹ãƒˆï¼ˆå„ãƒ„ãƒ¼ãƒ«ï¼‰
```typescript
// ä¾‹: web-crawler.ts
describe('WebCrawler', () => {
  test('single page crawl', async () => {
    const result = await webCrawler.execute({
      context: { startUrl: 'https://example.com', maxDepth: 0 }
    });
    expect(result.pagesCount).toBe(1);
  });
});
```

#### çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆRAGãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼‰
```typescript
describe('RAG Pipeline', () => {
  test('end-to-end Q&A', async () => {
    // 1. ãƒ‡ãƒ¼ã‚¿æŠ•å…¥
    await dataMaintenance.purgeAll();
    await webCrawler.execute({ context: { startUrl, maxDepth: 1 } });
    await documentProcessor.execute();
    
    // 2. è³ªå•ãƒ»å›ç­”
    const answer = await knowledgeSearcher.execute({
      context: { question: 'â—‹â—‹ã«ã¤ã„ã¦æ•™ãˆã¦' }
    });
    expect(answer).toContain('expected_content');
  });
});
```

### 11.2. æ®µéšçš„æ¤œè¨¼ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

#### Phase 1 å®Œäº†ãƒã‚§ãƒƒã‚¯
- [ ] Convexãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ãƒ†ãƒ¼ãƒ–ãƒ«ç¢ºèª
- [ ] Mastraãƒ—ãƒ¬ã‚¤ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰èµ·å‹•
- [ ] ç’°å¢ƒå¤‰æ•°æ¥ç¶šãƒ†ã‚¹ãƒˆ
- [ ] åŸºæœ¬ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå¿œç­”ç¢ºèª

#### Phase 2 å®Œäº†ãƒã‚§ãƒƒã‚¯
- [ ] å„ãƒ„ãƒ¼ãƒ«å˜ç‹¬å®Ÿè¡ŒæˆåŠŸ
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®æ­£å¸¸ãªèª­ã¿æ›¸ã
- [ ] ã‚¨ãƒ©ãƒ¼æ™‚ã®é©åˆ‡ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡ºåŠ›
- [ ] ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã®é©åˆ‡ãªå‡ºåŠ›

#### Phase 3 å®Œäº†ãƒã‚§ãƒƒã‚¯
- [ ] ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆçµŒç”±ã§ã®ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—æˆåŠŸ
- [ ] å®Œå…¨ãªRAGãƒ•ãƒ­ãƒ¼å‹•ä½œç¢ºèª
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆï¼ˆå°è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ï¼‰
- [ ] ç•°å¸¸ç³»å‡¦ç†ã®å‹•ä½œç¢ºèª

#### Phase 4 å®Œäº†ãƒã‚§ãƒƒã‚¯
- [ ] æœ¬ç•ªç’°å¢ƒã§ã®ãƒ‡ãƒ—ãƒ­ã‚¤æˆåŠŸ
- [ ] REST APIå‹•ä½œç¢ºèª
- [ ] å¤§é‡ãƒ‡ãƒ¼ã‚¿ã§ã®æ€§èƒ½æ¤œè¨¼
- [ ] ç›£è¦–ãƒ»ãƒ­ã‚°åŸºç›¤ã®å‹•ä½œç¢ºèª

## 12. å®Ÿè£…æ™‚ã®é‡è¦ãªæŒ‡é‡

### 12.1. ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

#### Mastraãƒ„ãƒ¼ãƒ«å®Ÿè£…ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
```typescript
import { createTool } from '@mastra/core/tools';  // å¿…é ˆ
import { z } from 'zod';

const inputSchema = z.object({
  param: z.string().describe("ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¬æ˜"),
});

export const toolName = createTool({
  id: 'unique-tool-id',
  description: 'å…·ä½“çš„ãªæ©Ÿèƒ½èª¬æ˜',
  inputSchema,
  outputSchema: z.object({ result: z.string() }),
  execute: async ({ context }) => {  // contextãƒ‘ã‚¿ãƒ¼ãƒ³å¿…é ˆ
    const { param } = context;       // ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å–å¾—
    
    // è‡ªå·±å®Œçµå‹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆæœŸåŒ–
    const client = new SomeClient(process.env.API_KEY);
    
    try {
      // ãƒ¡ã‚¤ãƒ³å‡¦ç†
      const result = await client.process(param);
      return { result };
    } catch (error) {
      console.error(`[TOOL_ERROR] ${error.message}`);
      throw error;
    }
  },
});
```

#### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æ¨™æº–ãƒ‘ã‚¿ãƒ¼ãƒ³
```typescript
try {
  const result = await externalAPI.call();
  console.log(`[SUCCESS] ${operationName}: ${result.summary}`);
  return result;
} catch (error) {
  const errorMsg = error instanceof Error ? error.message : 'Unknown error';
  console.error(`[ERROR] ${operationName}: ${errorMsg}`);
  throw new Error(`${operationName} failed: ${errorMsg}`);
}
```

### 12.2. ãƒ‡ãƒãƒƒã‚°ãƒ»ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

#### ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«æ¨™æº–
- `[INFO]`: æ­£å¸¸ãªå‡¦ç†é–‹å§‹ãƒ»å®Œäº†
- `[DEBUG]`: å†…éƒ¨å‡¦ç†ã®è©³ç´°æƒ…å ±
- `[WARN]`: ç¶™ç¶šå¯èƒ½ãªå•é¡Œ
- `[ERROR]`: å‡¦ç†å¤±æ•—ãƒ»ä¾‹å¤–

#### å…¸å‹çš„ãªå•é¡Œã¨è§£æ±ºç­–
1. **ãƒ„ãƒ¼ãƒ«å¼•æ•°ãŒæ¸¡ã‚‰ãªã„** â†’ ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ»executeç½²åç¢ºèª
2. **Convexæ¥ç¶šå¤±æ•—** â†’ ç’°å¢ƒå¤‰æ•°ãƒ»èªè¨¼è¨­å®šç¢ºèª
3. **ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ãŒå‹•ã‹ãªã„** â†’ ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å®šç¾©ãƒ»æ¬¡å…ƒæ•°ç¢ºèª
4. **ã‚¯ãƒ­ãƒ¼ãƒ«å¤±æ•—** â†’ Playwrightãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹è¨­å®šãƒ»ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆç¢ºèª

---

*ã“ã®PRDã¯å®Ÿè£…æ¸ˆã¿ã‚·ã‚¹ãƒ†ãƒ ã®åˆ†æã¨èª²é¡Œè§£æ±ºç­–ã‚’å«ã‚€ã€æ–°è¦å®Ÿè£…æ™‚ã®å®Œå…¨ãªè¨­è¨ˆæŒ‡é‡ã§ã™ã€‚*